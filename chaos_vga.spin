' //////////////////////////////////////////////////////////////////////
' Chaos - VGA
' AUTHOR: Brian Knoblauch
' LAST MODIFIED: 8.16.2013
' VERSION 1.0
'
' //////////////////////////////////////////////////////////////////////

'///////////////////////////////////////////////////////////////////////
' CONSTANTS SECTION ////////////////////////////////////////////////////
'///////////////////////////////////////////////////////////////////////

CON

  _clkmode = xtal2 + pll8x            ' enable external clock and pll times 4
  _xinfreq = 10_000_000 + 0000        ' set frequency to 10 MHZ plus some error
  _stack = ($3000 + $3000 + 64) >> 2  'accomodate display memory and stack
  SCREEN_WIDTH=640
  SCREEN_HEIGHT=480


'///////////////////////////////////////////////////////////////////////
' VARIABLES SECTION ////////////////////////////////////////////////////
'///////////////////////////////////////////////////////////////////////

VAR
  long  colors[64]                ' color look up table
  long  random
  byte  direction

'///////////////////////////////////////////////////////////////////////
' OBJECT DECLARATION SECTION ///////////////////////////////////////////
'///////////////////////////////////////////////////////////////////////
OBJ

  vga : "vga_drv_010.spin"  

'///////////////////////////////////////////////////////////////////////
' PUBLIC FUNCTIONS /////////////////////////////////////////////////////
'///////////////////////////////////////////////////////////////////////

PUB start | i, dx, dy, x, y, color

  ' BEGIN GAME LOOP ////////////////////////////////////////////////////
  
  ' initialize some vars
  x := SCREEN_WIDTH/2
  y := SCREEN_HEIGHT/2

  'clear the onscreen buffer
  'gr.clear
  
  ' infinite loop
  repeat while TRUE
  
    ' RENDERING SECTION (render to offscreen buffer always//////////////

    random:=?random
    direction:=random//3
    if direction==0
      x:=(x+(SCREEN_WIDTH/2))/2
      y:=(y+SCREEN_HEIGHT)/2
    elseif direction==1
      x:=x/2
      y:=y/2
    elseif direction==2
      x:=(x+SCREEN_WIDTH)/2
      y:=y/2    

    ' set pen attributes, color (1..3), size 0
    'gr.colorwidth(direction+1,0)
    'gr.plot(x, y)
    
    ' synchronize to frame rate would go here...

    ' END RENDERING SECTION ///////////////////////////////////////////////

  ' END MAIN GAME LOOP REPEAT BLOCK //////////////////////////////////

'///////////////////////////////////////////////////////////////////////
' DATA SECTION /////////////////////////////////////////////////////////
'///////////////////////////////////////////////////////////////////////

DAT
